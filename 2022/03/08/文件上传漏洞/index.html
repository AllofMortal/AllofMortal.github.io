<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="google-site-verification" content="TZE0rZyIqLl10trYu3BWBWa1Vmz6HFwhb2OcNEK4u-s" />
     <link rel="shortcut icon" href= /img/favicon.ico >
    <title>
        Hexo
    </title>
    <meta name="description" content= 嘿，我是Mortal这是我的博客，用于记录自己的笔记。欢迎指正！ >
    <meta name="keywords" content= Blog,Hexo,Theme,Mortal >
    
<link rel="stylesheet" href="/libs/highlight/styles/monokai-sublime.css">

    
<link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">

    
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 6.3.0"></head>
<body id="bodyx">
    <div class="hd posts">
    <a href="/index.html"><i class="fa fa-home
 replay-btn" aria-hidden="true"></i></a>
    <div class="post-title">
        <p>
            文件上传漏洞
        </p>
        <hr>
    </div>
    <div class="post-content">
        <h1 id="文件上传漏洞"><a href="#文件上传漏洞" class="headerlink" title="文件上传漏洞"></a>文件上传漏洞</h1><h2 id="1-描述"><a href="#1-描述" class="headerlink" title="1.描述"></a>1.描述</h2><p>文件上传漏洞是指由于程序员未对上传的文件进行严格的验证和过滤，而导致的用户可以越过其本身权限向服务器上传可执行的动态脚本文件。如常见的头像上传，图片上传，oa 办公文件上传，媒体上传，允许用户上传文件，如果过滤不严格，恶意用户利用文件上传漏洞，上传有害的可以执行脚本文件到服务器中，可以获取服务器的权限，或进一步危害服务器。</p>
<h3 id="1-1-危害"><a href="#1-1-危害" class="headerlink" title="1.1 危害"></a>1.1 危害</h3><p>非法用户可以上传的恶意文件控制整个网站，甚至是控制服务器，这个恶意脚本文件，又被称为 webshell，上传 webshell 后门 很方便地查看服务器信息，查看目录，执行系统命令等。</p>
<h2 id="2-有关文件上传的知识"><a href="#2-有关文件上传的知识" class="headerlink" title="2. 有关文件上传的知识"></a>2. 有关文件上传的知识</h2><h3 id="2-1-文件上传的过程"><a href="#2-1-文件上传的过程" class="headerlink" title="2.1 文件上传的过程"></a>2.1 <strong>文件上传的过程</strong></h3><p>客户端 选择发送的文件-&gt;服务器接收-&gt;网站程序判断-&gt;临时文件-&gt;移动到指定的路径<br>服务器 接收的资源程</p>
<p><em>服务器接收资源代码</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    if ($_FILES[&quot;file&quot;][&quot;error&quot;] &gt; 0)</span><br><span class="line">    &#123;</span><br><span class="line">    echo &quot;Error: &quot; . $_FILES[&quot;file&quot;][&quot;error&quot;] . &quot;&lt;br /&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">    echo &quot;Upload: &quot; . $_FILES[&quot;file&quot;][&quot;name&quot;] . &quot;&lt;br /&gt;&quot;;</span><br><span class="line">    echo &quot;Type: &quot; . $_FILES[&quot;file&quot;][&quot;type&quot;] . &quot;&lt;br /&gt;&quot;;</span><br><span class="line">    echo &quot;Size: &quot; . ($_FILES[&quot;file&quot;][&quot;size&quot;] / 1024) . &quot; Kb&lt;br /&gt;&quot;;</span><br><span class="line">    echo &quot;Stored in: &quot; . $_FILES[&quot;file&quot;][&quot;tmp_name&quot;];</span><br><span class="line">    &#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><em>客户端文件上传的代码</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line"> &lt;head&gt;&lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">   &lt;form action=&quot;upload.php&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span><br><span class="line">    &lt;label for=&quot;file&quot;&gt;Filename:&lt;/label&gt;</span><br><span class="line">    &lt;input type=&quot;file&quot; name=&quot;file&quot; id=&quot;file&quot; /&gt;</span><br><span class="line">    &lt;br /&gt;</span><br><span class="line">    &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;Submit&quot; /&gt;</span><br><span class="line">   &lt;/form&gt;</span><br><span class="line"> &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-文件上传代码"><a href="#2-2-文件上传代码" class="headerlink" title="2.2 文件上传代码"></a>2.2 <strong>文件上传代码</strong></h3><p>文件上传时会返回一些代码 返回客户端 客户端根据这些值判断上传是否正常</p>
<ul>
<li>值：0; 没有错误发生，文件上传成功。</li>
<li>值：1; 上传的文件超过了 php.ini 中 upload_max_filesize 选项限制。</li>
<li>值：2; 上传文件的大小超过了 HTML 表单中 MAX_FILE_SIZE 选项指定的值。</li>
<li>值：3; 文件只有部分被上传。</li>
<li>4; 没有文件被上传。</li>
</ul>
<h3 id="2-3-文件上传漏洞"><a href="#2-3-文件上传漏洞" class="headerlink" title="2.3 文件上传漏洞"></a>2.3 <strong>文件上传漏洞</strong></h3><p>文件上传漏洞分为 直接文件上传，这种漏洞类型是属于高危漏洞的一种，能直接 getshell，而且没有任何限制，攻击者很容易通过上传点，获取网站的控制权限，另外一种是有条件的上传漏洞，这种漏洞一般是开发者经验不足，对文件上传做了简单的限制，如简单的前端认证，文件头文件检测，这种检测行为，可以完全绕过的，另外一个方面就是权限认证没处理，没有对文件上传页面进行权限认证，匿名者就能访问上传文件，上传网页后门到网站目录，控制整个网站，还有一些上传逻辑有问题，导致文件上传可以被绕过，上传后门到网站上。有的文件上传漏洞则是通过中间件或者系统特性上传可以被服务器解析脚本文件，从而导致网站可被控制。</p>
<h3 id="2-4-文件上传漏洞的修复方案"><a href="#2-4-文件上传漏洞的修复方案" class="headerlink" title="2.4 文件上传漏洞的修复方案"></a>2.4 <strong>文件上传漏洞的修复方案</strong></h3><ul>
<li>在网站中需要存在上传模块，需要做好权限认证，不能让匿名用户可访问。</li>
<li>文件上传目录设置为禁止脚本文件执行。这样设置即使被上传后门的动态脚本也不能解析，导致攻击者放弃这个攻击途径。</li>
<li>设置上传白名单，白名单只允许图片上传如，<code>.jpg</code> <code>.png</code> <code>.gif</code> 其他文件均不允许上传</li>
<li>上传的后缀名，一定要设置成图片格式如 <code>.jpg</code> <code>.png</code> <code>.gif</code></li>
</ul>
<h2 id="3-文件上传的攻击方法"><a href="#3-文件上传的攻击方法" class="headerlink" title="3. 文件上传的攻击方法"></a>3. 文件上传的攻击方法</h2><p>寻找测试网站的文件上传的模块，常见 头像上传，修改上传，文件编辑器中文件上传，图片上传、媒体上传等，通过抓包上传恶意的文件进行测试，上传后缀名 asp php aspx 等的动态语言脚本，查看上传时的返回信息，判断是否能直接上传，如果不能直接上传，再进行测试上传突破，例如上传文件的时候只允许图片格式的后缀，但是修改文件时，却没有限制后缀名，图片文件可以修改成动态语言格式如 php，则可能访问这个文件的 URL 直接 getshell，可以控制网站。</p>
<h2 id="4-常见的网站文件后缀名"><a href="#4-常见的网站文件后缀名" class="headerlink" title="4. 常见的网站文件后缀名"></a>4. 常见的网站文件后缀名</h2><p>可执行脚本的文件后缀名，可被网站目录解析。以下是常见的后缀名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">asp</span><br><span class="line"></span><br><span class="line">asa</span><br><span class="line"></span><br><span class="line">cdx</span><br><span class="line"></span><br><span class="line">cer</span><br><span class="line"></span><br><span class="line">php</span><br><span class="line"></span><br><span class="line">aspx</span><br><span class="line"></span><br><span class="line">ashx</span><br><span class="line"></span><br><span class="line">jsp</span><br><span class="line"></span><br><span class="line">php3</span><br><span class="line"></span><br><span class="line">php.a</span><br><span class="line"></span><br><span class="line">shtml</span><br><span class="line"></span><br><span class="line">phtml</span><br></pre></td></tr></table></figure>
<p>有些网站会对 asp 或者 php 进行过滤转成空可用这些后缀名。<br>aspasp  asaspp<br>phpphp</p>
<h2 id="5-任意文件上传漏洞"><a href="#5-任意文件上传漏洞" class="headerlink" title="5. 任意文件上传漏洞"></a>5. 任意文件上传漏洞</h2><p>任意文件上传漏洞又名文件直接上传漏洞 这种漏洞危害极大，如果攻击者能直接上传恶意脚本到网站存放的目录，且这个目录可解析动态脚本语言，那么攻击者就能够直接获取网站权限，甚至进一步权限提升，控制服务器。</p>
<h3 id="5-1-任意文件上传演示"><a href="#5-1-任意文件上传演示" class="headerlink" title="5.1 任意文件上传演示"></a>5.1 任意文件上传演示</h3><p>选择写好的一句话脚本上传,网页会返回路径 访问 url 即可 getshell<br><img src="/image/DVWA.png" alt="DVWA"></p>
<p>上传的文件可以改成其他恶意脚本或者后门，如蚁剑，中国菜刀一句话，后门大马。即可获得 webshell。<br><img src="/image/phpinfo.png" alt="phpinfo"></p>
<p>这里我们用蚁剑做演示：<br>将后门地址和密码输入到蚁剑<br><img src="/image/AntSwort.png" alt="AntSwort"></p>
<p>即可获得最高权限<br><img src="/image/getshell.png" alt="getshell"></p>
<h3 id="5-2-绕过前端-js-检测上传"><a href="#5-2-绕过前端-js-检测上传" class="headerlink" title="5.2 绕过前端 js 检测上传"></a>5.2 绕过前端 js 检测上传</h3><p>在文件上传时，用户选择文件时，或者提交时，有些网站会对前端文件名进行验证，一般检测后缀名，是否为上传的格式。如果上传的格式不对，则弹出提示文字。此时数据包并没有提交到服务器，只是在客户端通过 js 文件进行校验，验证不通过则不会提交到服务器进行处理。<br><img src="/image/%E4%B8%8A%E4%BC%A0%E6%8B%A6%E6%88%AA.png" alt="上传拦截"></p>
<h4 id="5-2-1-绕过-js-检测方法"><a href="#5-2-1-绕过-js-检测方法" class="headerlink" title="5.2.1 绕过 js 检测方法"></a>5.2.1 绕过 js 检测方法</h4><ul>
<li>按 F12 使用网页审计元素，把校验的上传文件后缀名文件删除，即可上传。</li>
<li>把恶意文件改成 js 允许上传的文件后缀，如 jpg、gif、png 等，再通过抓包工具抓取 post 的数据包，把后缀名改成可执行的脚本后缀如 php 、asp、jsp、net 等。即可绕过上传。</li>
</ul>
<p>删除 js 文件（删除检测函数，便可直接上传）<br><img src="/image/%E5%88%A0%E9%99%A4js%E6%A3%80%E6%B5%8B%E5%87%BD%E6%95%B0.png" alt="删除js检测函数"></p>
<p>先修改后门文件后缀，改为可上传的文件格式，之后通过抓包修改后缀名<br><img src="/image/%E4%BF%AE%E6%94%B9%E5%90%8E%E7%BC%80%E5%90%8D.png" alt="修改后缀名"></p>
<h3 id="5-3-绕过-contnet-type-检测上传"><a href="#5-3-绕过-contnet-type-检测上传" class="headerlink" title="5.3 绕过 contnet-type 检测上传"></a>5.3 绕过 contnet-type 检测上传</h3><p>有些上传模块，会对 http 的类型头进行检测，如果是图片类型，允许上传文件到服务器，否则返回上传失败。因为服务端是通过 content-type 判断类型，content-type 在客户端可被修改。则此文件上传也有可能被绕过的风险。</p>
<h4 id="5-3-1-content-type-检测上传攻"><a href="#5-3-1-content-type-检测上传攻" class="headerlink" title="5.3.1 content-type 检测上传攻"></a>5.3.1 content-type 检测上传攻</h4><p>上传文件,脚本文件，抓包把 content-type 修改成 image&#x2F;jpeg 即可绕过上传。<br><a target="_blank" rel="noopener" href="https://www.runoob.com/http/http-content-type.html">contnet-type 类型</a><br><img src="/contnet-type.png" alt="contnet-type"></p>
<h2 id="6-绕过黑名单上传"><a href="#6-绕过黑名单上传" class="headerlink" title="6. 绕过黑名单上传"></a>6. 绕过黑名单上传</h2><p>上传模块，有时候会写成黑名单限制，在上传文件的时获取后缀名，再把后缀名与程序中黑名单进行检测，如果后缀名在黑名单的列表内，文件将禁止文件上传。</p>
<h3 id="6-1-黑名单代码分析"><a href="#6-1-黑名单代码分析" class="headerlink" title="6.1 黑名单代码分析"></a>6.1 黑名单代码分析</h3><p>首先是检测 submit 是否有值，获取文件的后缀名，进行黑名单对比，后缀名不<br>在黑名单内，允许上传。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = false;</span><br><span class="line">$msg = null;</span><br><span class="line">if (isset($_POST[&#x27;submit&#x27;])) &#123;</span><br><span class="line">    if (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = array(&#x27;.asp&#x27;,&#x27;.aspx&#x27;,&#x27;.php&#x27;,&#x27;.jsp&#x27;);    //建立一个黑名单数组用于匹配</span><br><span class="line">        $file_name = trim($_FILES[&#x27;upload_file&#x27;][&#x27;name&#x27;]);  // 过滤前后空白</span><br><span class="line">        $file_name = deldot($file_name);//删除文件名末尾的点</span><br><span class="line">        $file_ext = strrchr($file_name, &#x27;.&#x27;);     //返回从 . 后的所有字符</span><br><span class="line">        $file_ext = strtolower($file_ext); //转换为小写</span><br><span class="line">        $file_ext = str_ireplace(&#x27;::$DATA&#x27;, &#x27;&#x27;, $file_ext);//去除字符串::$DATA</span><br><span class="line">        $file_ext = trim($file_ext); //收尾去空</span><br><span class="line"></span><br><span class="line">        if(!in_array($file_ext, $deny_ext)) &#123;     //如果不在数组内则进行以下循环</span><br><span class="line">            $temp_file = $_FILES[&#x27;upload_file&#x27;][&#x27;tmp_name&#x27;];</span><br><span class="line">            $img_path = UPLOAD_PATH.&#x27;/&#x27;.date(&quot;YmdHis&quot;).rand(1000,9999).$file_ext;   //进行后缀匹配          </span><br><span class="line">            if (move_uploaded_file($temp_file,$img_path)) &#123;</span><br><span class="line">                 $is_upload = true;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                $msg = &#x27;上传出错！&#x27;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            $msg = &#x27;不允许上传.asp,.aspx,.php,.jsp后缀文件！&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . &#x27;文件夹不存在,请手工创建！&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6-1-1-绕过黑名单上传攻击"><a href="#6-1-1-绕过黑名单上传攻击" class="headerlink" title="6.1.1 绕过黑名单上传攻击"></a>6.1.1 绕过黑名单上传攻击</h4><p>上传图片时，如果提示不允许 php、asp 这种信息提示，可判断为黑名单限制，上传黑名单以外的后缀名即可。</p>
<p>在 iis 里 asp 禁止上传了，可以上传 asa cer cdx 这些后缀，如在网站里允许.net执行 可以上传 ashx 代替 aspx。如果网站可以执行这些脚本，通过上传后门即可获取 webshell。</p>
<p>在不同的中间件中有特殊的情况，如果在 apache 可以开启 application&#x2F;x-httpd-php 在 AddType application&#x2F;x-httpd-php .php .phtml .php3 后缀名为 phtml 、php3 均被解析成 php 有的 apache 版本默认就会开启。<br>上传目标中间件可支持的环境的语言脚本即可，如.phtml、php3。<br><img src="/image/phtml.png" alt="phtml"><br>能否上传成功还是要看是否过滤后缀以及 apache 是否开启application&#x2F;x-httpd-php</p>
<h3 id="6-2-大小写绕过上传攻击"><a href="#6-2-大小写绕过上传攻击" class="headerlink" title="6.2 大小写绕过上传攻击"></a>6.2 大小写绕过上传攻击</h3><p>有的上传模块 后缀名采用黑名单判断，但是没有对后缀名的大小写进行严格判断，导致可以更改后缀大小写可以被绕过。如 PHP、 Php、 phP、pHp</p>
<p>仔细阅读黑名单，查看是否有被忽略的后缀名，当前可以使用 pHP 绕过</p>
<p><img src="/image/pHP.png" alt="pHP"></p>
<h3 id="6-3-空格绕过攻击"><a href="#6-3-空格绕过攻击" class="headerlink" title="6.3 空格绕过攻击"></a>6.3 空格绕过攻击</h3><p>在上传模块里，采用黑名单上传，如果没有对空格进行过滤可能被绕过。</p>
<p>抓包上传，在后缀名后添加空格<br><img src="/image/%E7%A9%BA%E7%99%BD%E7%BB%95%E8%BF%87.png" alt="空白绕过"></p>
<h3 id="6-4-利用-windows-系统特征绕过上传攻击"><a href="#6-4-利用-windows-系统特征绕过上传攻击" class="headerlink" title="6.4 利用 windows 系统特征绕过上传攻击"></a>6.4 利用 windows 系统特征绕过上传攻击</h3><p>在 windows中 文件后缀名. 系统会自动忽略.所以 shell.php. 像 shell.php 的效果一样。所以可以在文件名后面机上.绕过。<br>如果没有过滤文件后缀名后的点便可以上传 <code>.php.</code> 这种文件后缀</p>
<p>抓包修改在后缀名后加上<code>.</code>即可绕过。<br><img src="/image/php..png" alt="php."></p>
<h3 id="6-5-NTFS-交换数据流-DATA-绕过上传攻击"><a href="#6-5-NTFS-交换数据流-DATA-绕过上传攻击" class="headerlink" title="6.5 NTFS 交换数据流::$DATA 绕过上传攻击"></a>6.5 NTFS 交换数据流::$DATA 绕过上传攻击</h3><p>如果后缀名没有对::$DATA 进行判断，利用 windows 系统 NTFS 特征可以绕过上传。</p>
<p>如果程序中没有对 <code>::$DATA</code> 进行过滤可以添加<code>::$DATA</code> 绕过上传。</p>
<p>burpsuite 抓包，修改后缀名为 <code>php::$DAT</code><br><img src="/NTFS.png" alt="NTFS"></p>
<h3 id="6-6-利用-windows-环境的叠加特征绕过上传"><a href="#6-6-利用-windows-环境的叠加特征绕过上传" class="headerlink" title="6.6 利用 windows 环境的叠加特征绕过上传"></a>6.6 利用 windows 环境的叠加特征绕过上传</h3><p>在 windwos 中如果上传文件名 mortal.php:.jpg 的时候，会在目录下生产空白的文件名 moonsec.php再利用 php 和windows 环境的叠加属性，<br>以下符号在正则匹配时相等<br>双引号<code>&quot;</code>等于 点号<code>.</code>大于符号<code>&gt;</code>等于 问号<code>?</code><br>小于符号<code>&lt;</code>等于 星号<code>*</code><br>文件名<code>.&lt;</code>或文件名<code>.&lt;&lt;&lt;</code>或文件名<code>.&gt;&gt;&gt;</code>或文件名<code>.&gt;&gt;&lt;</code>空文件名</p>
<h4 id="6-6-1-利用-windows-环境的叠加特征绕过"><a href="#6-6-1-利用-windows-环境的叠加特征绕过" class="headerlink" title="6.6.1 利用 windows 环境的叠加特征绕过"></a>6.6.1 利用 windows 环境的叠加特征绕过</h4><p>首先抓包上传 s.php:.jpg 上传会在目录里生成 s.php 空白文件，接着再次提交把<code>s.php</code>改成<code>s.&gt;&gt;&gt;</code></p>
<p>因为 <code>.php</code> 在过滤黑名单内所以需要改为 <code>:.jpg</code> 上传，此时上传的为空脚本<br><img src="/image/%E7%8E%AF%E5%A2%83%E5%8F%A0%E5%8A%A0.png" alt="环境叠加"></p>
<p>再次抓包将 <code>s.php</code> 改为<code>s.&gt;&gt;&gt;</code> 利用 windows 特性将脚本写入<br><img src="/image/%E5%86%99%E5%85%A5%E8%84%9A%E6%9C%AC.png" alt="写入脚本"></p>
<h3 id="6-7-双写后缀名绕过上传"><a href="#6-7-双写后缀名绕过上传" class="headerlink" title="6.7 双写后缀名绕过上传"></a>6.7 双写后缀名绕过上传</h3><p>在上传模块，有的代码会把黑名单的后缀名替换成空，例如 a.php 会把 php 替换成空，但是可以使用双写绕过例如 asaspp，pphphp，即可绕过上传。</p>
<h4 id="6-7-1-文件上传双写绕过漏洞分析"><a href="#6-7-1-文件上传双写绕过漏洞分析" class="headerlink" title="6.7.1 文件上传双写绕过漏洞分析"></a>6.7.1 文件上传双写绕过漏洞分析</h4><p>str_ireplace 对上传的后缀名是黑名单内的字符串转换成空。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = false;</span><br><span class="line">$msg = null;</span><br><span class="line">if (isset($_POST[&#x27;submit&#x27;])) &#123;</span><br><span class="line">    if (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = array(&quot;php&quot;,&quot;php5&quot;,&quot;php4&quot;,&quot;php3&quot;,&quot;php2&quot;,&quot;html&quot;,&quot;htm&quot;,&quot;phtml&quot;,&quot;pht&quot;,&quot;jsp&quot;,&quot;jspa&quot;,&quot;jspx&quot;,&quot;jsw&quot;,&quot;jsv&quot;,&quot;jspf&quot;,&quot;jtml&quot;,&quot;asp&quot;,&quot;aspx&quot;,&quot;asa&quot;,&quot;asax&quot;,&quot;ascx&quot;,&quot;ashx&quot;,&quot;asmx&quot;,&quot;cer&quot;,&quot;swf&quot;,&quot;htaccess&quot;);</span><br><span class="line"></span><br><span class="line">        $file_name = trim($_FILES[&#x27;upload_file&#x27;][&#x27;name&#x27;]);</span><br><span class="line">        $file_name = str_ireplace($deny_ext,&quot;&quot;, $file_name);    // 对上传的后缀名是黑名单内的字符串转换成空。</span><br><span class="line">        $temp_file = $_FILES[&#x27;upload_file&#x27;][&#x27;tmp_name&#x27;];</span><br><span class="line">        $img_path = UPLOAD_PATH.&#x27;/&#x27;.$file_name;        </span><br><span class="line">        if (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">            $is_upload = true;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            $msg = &#x27;上传出错！&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . &#x27;文件夹不存在,请手工创建！&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6-7-2-文件上传双写绕过攻击"><a href="#6-7-2-文件上传双写绕过攻击" class="headerlink" title="6.7.2 文件上传双写绕过攻击"></a>6.7.2 文件上传双写绕过攻击</h4><p>抓包上传，把后缀名改成<code>pphphp</code>即可绕过上传.<br><img src="/image/%E5%8F%8C%E5%86%99%E5%90%8E%E7%BC%80%E5%90%8D.png" alt="双写后缀名"></p>
<h3 id="6-8-htaccess-重写解析绕过上传"><a href="#6-8-htaccess-重写解析绕过上传" class="headerlink" title="6.8 htaccess 重写解析绕过上传"></a>6.8 htaccess 重写解析绕过上传</h3><p>上传模块，黑名单过滤了所有的能执行的后缀名,如果允许上传.htaccess。htaccess文件的作用是 可以帮我们实现包括：文件夹密码保护、用户自动重定向、自定义错误页面、改变你的文件扩展名、封禁特定 IP 地址的用户、只允许特定 IP 地址的用户、禁止目录列表，以及使用其他文件作为 index 文件等一些功能。<br>在 htaccess 里写入 SetHandler application&#x2F;x-httpd-php 则可以文件重写成 php 文件。要 htaccess 的规则生效 则需要在 apache 开启 rewrite 重写模块，因为 apache 是多数都开启这个模块，所以规则一般都生效。</p>
<p>是多数都开启这个模块，所以规则一般都生效。<br><img src="/image/http%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6.png" alt="http配置文件"></p>
<h4 id="6-8-1-黑名单上传代码分析"><a href="#6-8-1-黑名单上传代码分析" class="headerlink" title="6.8.1 黑名单上传代码分析"></a>6.8.1 黑名单上传代码分析</h4><p>如果 submit 有值，$deny_ext &#x3D;array(“.php”,”.php5”,”.php4”,”.php3”,”.php2”,”php1”,”.html”,”.htm”,”.phtml”,”.pht”,”.pHp”,”.pHp5”,”.pHp4”,”.pHp3”,”.pHp2”,”pHp1”,”.Html”,”.Htm”,”.pHtml”,”.jsp”,”.jspa”,”.jspx”,”.jsw”,”.jsv”,”.jspf”,”.jtml”,”.jSp”,”.jSpx”,”.jSpa”,”.jSw”,”.jSv”,”.jSpf”,”.jHtml”,”.asp”,”.aspx”,”.asa”,”.asax”,”.ascx”,”.ashx”,”.asmx”,”.cer”,”.aSp”,”.aSpx”,”.aSa”,”.aSax”,”.aScx”,”aShx”,”.aSmx”,”.cEr”,”.sWf”,”.swf”);<br>上传的文件后缀名在列表内禁止上传。包括了所有的执行脚本。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = false;</span><br><span class="line">$msg = null;</span><br><span class="line">if (isset($_POST[&#x27;submit&#x27;])) &#123;</span><br><span class="line">    if (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = array(&quot;.php&quot;,&quot;.php5&quot;,&quot;.php4&quot;,&quot;.php3&quot;,&quot;.php2&quot;,&quot;php1&quot;,&quot;.html&quot;,&quot;.htm&quot;,&quot;.phtml&quot;,&quot;.pht&quot;,&quot;.pHp&quot;,&quot;.pHp5&quot;,&quot;.pHp4&quot;,&quot;.pHp3&quot;,&quot;.pHp2&quot;,&quot;pHp1&quot;,&quot;.Html&quot;,&quot;.Htm&quot;,&quot;.pHtml&quot;,&quot;.jsp&quot;,&quot;.jspa&quot;,&quot;.jspx&quot;,&quot;.jsw&quot;,&quot;.jsv&quot;,&quot;.jspf&quot;,&quot;.jtml&quot;,&quot;.jSp&quot;,&quot;.jSpx&quot;,&quot;.jSpa&quot;,&quot;.jSw&quot;,&quot;.jSv&quot;,&quot;.jSpf&quot;,&quot;.jHtml&quot;,&quot;.asp&quot;,&quot;.aspx&quot;,&quot;.asa&quot;,&quot;.asax&quot;,&quot;.ascx&quot;,&quot;.ashx&quot;,&quot;.asmx&quot;,&quot;.cer&quot;,&quot;.aSp&quot;,&quot;.aSpx&quot;,&quot;.aSa&quot;,&quot;.aSax&quot;,&quot;.aScx&quot;,&quot;.aShx&quot;,&quot;.aSmx&quot;,&quot;.cEr&quot;,&quot;.sWf&quot;,&quot;.swf&quot;);</span><br><span class="line">        $file_name = trim($_FILES[&#x27;upload_file&#x27;][&#x27;name&#x27;]);</span><br><span class="line">        $file_name = deldot($file_name);//删除文件名末尾的点</span><br><span class="line">        $file_ext = strrchr($file_name, &#x27;.&#x27;);</span><br><span class="line">        $file_ext = strtolower($file_ext); //转换为小写</span><br><span class="line">        $file_ext = str_ireplace(&#x27;::$DATA&#x27;, &#x27;&#x27;, $file_ext);//去除字符串::$DATA</span><br><span class="line">        $file_ext = trim($file_ext); //收尾去空</span><br><span class="line"></span><br><span class="line">        if (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[&#x27;upload_file&#x27;][&#x27;tmp_name&#x27;];</span><br><span class="line">            $img_path = UPLOAD_PATH.&#x27;/&#x27;.date(&quot;YmdHis&quot;).rand(1000,9999).$file_ext;</span><br><span class="line">            if (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $is_upload = true;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                $msg = &#x27;上传出错！&#x27;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            $msg = &#x27;此文件不允许上传!&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . &#x27;文件夹不存在,请手工创建！&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6-8-2-htaccess-重写解析攻击"><a href="#6-8-2-htaccess-重写解析攻击" class="headerlink" title="6.8.2 htaccess 重写解析攻击"></a>6.8.2 htaccess 重写解析攻击</h4><p>上传<code>.htaccess</code>到网站里<code>.htaccess</code>内容是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;jpg&quot;&gt;</span><br><span class="line">SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure>
<p>再上传恶意的 jpg 到<code>.htaccess</code>相同目录里，访问图片即可获取执行脚本。<br><img src="/image/htaccess.png" alt="htaccess"></p>
<ul>
<li><strong>注意</strong> 文件名必须为<code>.htaccess</code></li>
</ul>
<p>访问 jpg 图片便可 getshell。<br><img src="/image/htaccess%E6%94%BB%E5%87%BB.png" alt="htaccess攻击"></p>
<h3 id="6-9-文件名可控绕过上传"><a href="#6-9-文件名可控绕过上传" class="headerlink" title="6.9 文件名可控绕过上传"></a>6.9 文件名可控绕过上传</h3><p>文件上传时,文件名的可被客户端修改控制,会导致漏洞产生。</p>
<h4 id="6-9-1-文件名控代码分析"><a href="#6-9-1-文件名控代码分析" class="headerlink" title="6.9.1 文件名控代码分析"></a>6.9.1 文件名控代码分析</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = false;</span><br><span class="line">$msg = null;</span><br><span class="line">if (isset($_POST[&#x27;submit&#x27;])) &#123;</span><br><span class="line">    if (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = array(&quot;php&quot;,&quot;php5&quot;,&quot;php4&quot;,&quot;php3&quot;,&quot;php2&quot;,&quot;html&quot;,&quot;htm&quot;,&quot;phtml&quot;,&quot;pht&quot;,&quot;jsp&quot;,&quot;jspa&quot;,&quot;jspx&quot;,&quot;jsw&quot;,&quot;jsv&quot;,&quot;jspf&quot;,&quot;jtml&quot;,&quot;asp&quot;,&quot;aspx&quot;,&quot;asa&quot;,&quot;asax&quot;,&quot;ascx&quot;,&quot;ashx&quot;,&quot;asmx&quot;,&quot;cer&quot;,&quot;swf&quot;,&quot;htaccess&quot;);</span><br><span class="line"></span><br><span class="line">        $file_name = $_POST[&#x27;save_name&#x27;];   //保存文件名并提交</span><br><span class="line">        $file_ext = pathinfo($file_name,PATHINFO_EXTENSION);</span><br><span class="line"></span><br><span class="line">        if(!in_array($file_ext,$deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[&#x27;upload_file&#x27;][&#x27;tmp_name&#x27;];</span><br><span class="line">            $img_path = UPLOAD_PATH . &#x27;/&#x27; .$file_name;</span><br><span class="line">            if (move_uploaded_file($temp_file, $img_path)) &#123; </span><br><span class="line">                $is_upload = true;</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                $msg = &#x27;上传出错！&#x27;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            $msg = &#x27;禁止保存为该类型文件！&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . &#x27;文件夹不存在,请手工创建！&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>采用黑名单限制上传文件,但是 $_POST[‘save_name’]文件是可控的,可被客户端任意修改,造成安全漏洞。</p>
<h4 id="6-9-2-文件名控可控攻击方法"><a href="#6-9-2-文件名控可控攻击方法" class="headerlink" title="6.9.2 文件名控可控攻击方法"></a>6.9.2 文件名控可控攻击方法</h4><p>文件名攻击的方法主要有两种（另外还有一种非主流）</p>
<ol>
<li>上传文件,文件吗采用%00 截断,抓包解码例如 moon.php%00.php 截断后moon.php 或者使用<code>/.</code> <strong>需 php 版本小于 5.3.4</strong></li>
<li>与中间的漏洞配合使用 例如 iis6.0 上传 1.php;1.jpg apache 上传 <code>1.php.a</code> 也能解析文件 <code>a.asp;1.jpg</code> 解析成 <code>asp</code></li>
</ol>
<p><code>%00</code> 截断 需要<code>gpc</code>关闭 抓包 <strong>解码</strong>（需要将%00<strong>decode</strong>成为URL码） 提交即可 截断文件名 <strong>php 版本小于 5.3.4</strong><br><img src="/image/%E6%96%87%E4%BB%B6%E5%8F%AF%E6%8E%A700%E6%88%AA%E6%96%AD.png" alt="文件可控00截断"><br>或者改为可以使用 <code>/.</code> 需要没有过滤php版本较低可使用<br><img src="/image/%E5%86%B7%E9%97%A8%E4%B8%8A%E4%BC%A0.png" alt="冷门上传"></p>
<p>将文件名 1.php;.jpg 改成 iis6.0 可解析文件<br><img src="/image/%E6%94%B9%E4%B8%BA%E5%8F%AF%E8%A7%A3%E6%9E%90%E5%90%8E%E7%BC%80.png" alt="改为iis6可解析后缀"><br><img src="/image/2.ph;.jpeg.png" alt="2.ph;.jpeg"></p>
<p>低版本php可解析后缀<br><img src="/image/%E5%8F%AF%E8%A7%A3%E6%9E%90%E5%90%8E%E7%BC%80.png" alt="可解析后缀"><br><img src="/image/%E5%8F%AF%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0.png" alt="可解析漏洞复现"></p>
<h2 id="7-白名单绕过"><a href="#7-白名单绕过" class="headerlink" title="7. 白名单绕过"></a>7. 白名单绕过</h2><p>使用白名单验证会相对比较安全，因为只允许指定的文件后缀名。但是如果有可控的参数目录，也存在被绕过的风险。</p>
<h3 id="7-1-目录可控-GET-00-截断绕过上传攻击"><a href="#7-1-目录可控-GET-00-截断绕过上传攻击" class="headerlink" title="7.1 目录可控 GET %00 截断绕过上传攻击"></a>7.1 目录可控 GET <code>%00 截断</code>绕过上传攻击</h3><p>代码中使用白名单限制上传的文件后缀名，只允许指定的图片格式。但是$_GET[‘save_path’]服务器接受客户端的值，这个值可被客户端修改。所以会留下安全问题。</p>
<p><strong>上传参数可控</strong></p>
<ul>
<li>当 gpc 关闭的情况下，可以用%00 对目录或者文件名进行截断。</li>
<li><strong>php 版本小于 5.3.4</strong><br>首先截断攻击，抓包上传将<code>%00</code>自动截断后门内容。<br>例如 1.php%00.1.jpg 变成 1.php<br><img src="/image/%00%E6%88%AA%E6%96%AD.png" alt="%00截断"></li>
</ul>
<h3 id="7-2-目录可控-POST-绕过上传攻击"><a href="#7-2-目录可控-POST-绕过上传攻击" class="headerlink" title="7.2 目录可控 POST 绕过上传攻击"></a>7.2 目录可控 POST 绕过上传攻击</h3><p>上面是 GET 请求的，可以直接在 url 输入%00 即可截断，但是在 post 下直接注入%00 是不行的，需要把%00 解码变成空白符，截断才有效。才能把目录截断成文件名。</p>
<p><code>$_POST[&#39;save_path&#39;]</code>是接收客户端提交的值，客户端可任意修改。所以会产生安全漏洞。</p>
<p>文件名可控，通过抓包修改可控的参数，与不同的中间件的缺陷配合使用。</p>
<ul>
<li>使用%00 截断文件名 再 post 环境下%00 要经过 decode 但是受 gpc 限制使用 burpsutie POST %00 截断文件名。<br><img src="/image/%00decode.png" alt="%00decode"><br><img src="/image/post%E4%B8%8A%E4%BC%A0.png" alt="post上传"></li>
</ul>
<h3 id="7-3-文件头检测绕过上传"><a href="#7-3-文件头检测绕过上传" class="headerlink" title="7.3 文件头检测绕过上传"></a>7.3 文件头检测绕过上传</h3><p>有的文件上传，上传时候会检测头文件，不同的文件，头文件也不尽相同。常见的文件上传图片头检测 它检测图片是两个字节的长度，如果不是图片的格式，会禁止上传。</p>
<p>常见的文件头</p>
<ul>
<li><strong>JPEG (jpg)<strong>，文件头：</strong>FFD8FF</strong></li>
<li><strong>PNG (png)<strong>，文件头：</strong>89504E4</strong></li>
<li><strong>GIF (gif)<strong>，文件头：</strong>47494638</strong></li>
<li><strong>TIFF (tif)<strong>，文件头：</strong>49492A00</strong></li>
<li><strong>Windows Bitmap (bmp)<strong>，文件头：</strong>424D</strong></li>
</ul>
<h4 id="7-3-1-文件头检测上传代码分析"><a href="#7-3-1-文件头检测上传代码分析" class="headerlink" title="7.3.1 文件头检测上传代码分析"></a>7.3.1 文件头检测上传代码分析</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">function getReailFileType($filename)&#123;</span><br><span class="line">    $file = fopen($filename, &quot;rb&quot;);</span><br><span class="line">    $bin = fread($file, 2); //只读2字节</span><br><span class="line">    fclose($file);</span><br><span class="line">    $strInfo = @unpack(&quot;C2chars&quot;, $bin);    </span><br><span class="line">    $typeCode = intval($strInfo[&#x27;chars1&#x27;].$strInfo[&#x27;chars2&#x27;]);    </span><br><span class="line">    $fileType = &#x27;&#x27;;    </span><br><span class="line">    switch($typeCode)&#123;      </span><br><span class="line">        case 255216:            </span><br><span class="line">            $fileType = &#x27;jpg&#x27;;</span><br><span class="line">            break;</span><br><span class="line">        case 13780:            </span><br><span class="line">            $fileType = &#x27;png&#x27;;</span><br><span class="line">            break;        </span><br><span class="line">        case 7173:            </span><br><span class="line">            $fileType = &#x27;gif&#x27;;</span><br><span class="line">            break;</span><br><span class="line">        default:            </span><br><span class="line">            $fileType = &#x27;unknown&#x27;;</span><br><span class="line">        &#125;    </span><br><span class="line">        return $fileType;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$is_upload = false;</span><br><span class="line">$msg = null;</span><br><span class="line">if(isset($_POST[&#x27;submit&#x27;]))&#123;</span><br><span class="line">    $temp_file = $_FILES[&#x27;upload_file&#x27;][&#x27;tmp_name&#x27;];</span><br><span class="line">    $file_type = getReailFileType($temp_file);</span><br><span class="line"></span><br><span class="line">    if($file_type == &#x27;unknown&#x27;)&#123;</span><br><span class="line">        $msg = &quot;文件未知，上传失败！&quot;;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        $img_path = UPLOAD_PATH.&quot;/&quot;.rand(10, 99).date(&quot;YmdHis&quot;).&quot;.&quot;.$file_type;</span><br><span class="line">        if(move_uploaded_file($temp_file,$img_path))&#123;</span><br><span class="line">            $is_upload = true;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            $msg = &quot;上传出错！&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个是存在文件头检测的上传，getReailFileType 是检测 jpg、png、gif 的文件。如果上传的文件符合数字即可通过检测。</p>
<h4 id="7-3-2-文件头检测绕过传攻击方法"><a href="#7-3-2-文件头检测绕过传攻击方法" class="headerlink" title="7.3.2 文件头检测绕过传攻击方法"></a>7.3.2 文件头检测绕过传攻击方法</h4><ol>
<li>作图片一句话，使用 copy 1.gif&#x2F;b+moon.php shell.php 将 php 文件附加再 jpg 图片上，直接上传即可。</li>
</ol>
<p><img src="/image/cmd%E5%8F%A0%E5%8A%A0%E6%96%87%E4%BB%B6.png" alt="cmd叠加文件"></p>
<p>然后打开文件包含漏洞界面进行getshell<br><img src="/image/include.png" alt="文件包含"><br>代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">/*</span><br><span class="line">本页面存在文件包含漏洞，用于测试图片马是否能正常运行！</span><br><span class="line">*/</span><br><span class="line">header(&quot;Content-Type:text/html;charset=utf-8&quot;);</span><br><span class="line">$file = $_GET[&#x27;file&#x27;];</span><br><span class="line">if(isset($file))&#123;</span><br><span class="line">    include $file;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    show_source(__file__);</span><br><span class="line">&#125;</span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>
<ol start="2">
<li>使用 burpsuite 上传数据包 修改头文件添加文件头<br><img src="/image/brup%E4%BF%AE%E6%94%B9.png" alt="brup修改"></li>
</ol>
<h4 id="7-3-3-图片检测函数绕过上传"><a href="#7-3-3-图片检测函数绕过上传" class="headerlink" title="7.3.3 图片检测函数绕过上传"></a>7.3.3 图片检测函数绕过上传</h4><p><code>getimagesize()</code>获取图片大小<br>上传图片马即可绕过</p>
<h3 id="7-4-绕过图片二次渲染上传"><a href="#7-4-绕过图片二次渲染上传" class="headerlink" title="7.4 绕过图片二次渲染上传"></a>7.4 绕过图片二次渲染上传</h3><p>有些图片上传，会对上传的图片进行二次渲染后在保存，体积可能会更小，图片会模糊一些，但是符合网站的需求。例如新闻图片封面等可能需要二次渲染，因为原图片占用的体积更大。访问的人数太多时候会占用，很大带宽。二次渲染后的图片内容会减少，如果里面包含后门代码，可能会被省略。导致上传的图片马，恶意代码被清除。</p>
<h4 id="7-4-1-图片二次渲染分析代码"><a href="#7-4-1-图片二次渲染分析代码" class="headerlink" title="7.4.1 图片二次渲染分析代码"></a>7.4.1 图片二次渲染分析代码</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = false;</span><br><span class="line">$msg = null;</span><br><span class="line">if (isset($_POST[&#x27;submit&#x27;]))&#123;</span><br><span class="line">    // 获得上传文件的基本信息，文件名，类型，大小，临时文件路径</span><br><span class="line">    $filename = $_FILES[&#x27;upload_file&#x27;][&#x27;name&#x27;];</span><br><span class="line">    $filetype = $_FILES[&#x27;upload_file&#x27;][&#x27;type&#x27;];</span><br><span class="line">    $tmpname = $_FILES[&#x27;upload_file&#x27;][&#x27;tmp_name&#x27;];</span><br><span class="line"></span><br><span class="line">    $target_path=UPLOAD_PATH.&#x27;/&#x27;.basename($filename);   //获取文件名以及后缀名</span><br><span class="line"></span><br><span class="line">    // 获得上传文件的扩展名</span><br><span class="line">    $fileext= substr(strrchr($filename,&quot;.&quot;),1);</span><br><span class="line"></span><br><span class="line">    //判断文件后缀与类型，合法才进行上传操作</span><br><span class="line">    if(($fileext == &quot;jpg&quot;) &amp;&amp; ($filetype==&quot;image/jpeg&quot;))&#123;</span><br><span class="line">        if(move_uploaded_file($tmpname,$target_path))&#123;</span><br><span class="line">            //使用上传的图片生成新的图片</span><br><span class="line">            $im = imagecreatefromjpeg($target_path);</span><br><span class="line"></span><br><span class="line">            if($im == false)&#123;</span><br><span class="line">                $msg = &quot;该文件不是jpg格式的图片！&quot;;</span><br><span class="line">                @unlink($target_path);          //删除源文件</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                //给新图片指定文件名</span><br><span class="line">                srand(time());</span><br><span class="line">                $newfilename = strval(rand()).&quot;.jpg&quot;;</span><br><span class="line">                //显示二次渲染后的图片（使用用户上传图片生成的新图片）</span><br><span class="line">                $img_path = UPLOAD_PATH.&#x27;/&#x27;.$newfilename;</span><br><span class="line">                imagejpeg($im,$img_path);</span><br><span class="line">                @unlink($target_path);</span><br><span class="line">                $is_upload = true;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            $msg = &quot;上传出错！&quot;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;else if(($fileext == &quot;png&quot;) &amp;&amp; ($filetype==&quot;image/png&quot;))&#123;</span><br><span class="line">        if(move_uploaded_file($tmpname,$target_path))&#123;</span><br><span class="line">            //使用上传的图片生成新的图片</span><br><span class="line">            $im = imagecreatefrompng($target_path);</span><br><span class="line"></span><br><span class="line">            if($im == false)&#123;</span><br><span class="line">                $msg = &quot;该文件不是png格式的图片！&quot;;</span><br><span class="line">                @unlink($target_path);</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                 //给新图片指定文件名</span><br><span class="line">                srand(time());</span><br><span class="line">                $newfilename = strval(rand()).&quot;.png&quot;;</span><br><span class="line">                //显示二次渲染后的图片（使用用户上传图片生成的新图片）</span><br><span class="line">                $img_path = UPLOAD_PATH.&#x27;/&#x27;.$newfilename;</span><br><span class="line">                imagepng($im,$img_path);</span><br><span class="line"></span><br><span class="line">                @unlink($target_path);</span><br><span class="line">                $is_upload = true;               </span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            $msg = &quot;上传出错！&quot;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;else if(($fileext == &quot;gif&quot;) &amp;&amp; ($filetype==&quot;image/gif&quot;))&#123;</span><br><span class="line">        if(move_uploaded_file($tmpname,$target_path))&#123;</span><br><span class="line">            //使用上传的图片生成新的图片</span><br><span class="line">            $im = imagecreatefromgif($target_path);</span><br><span class="line">            if($im == false)&#123;</span><br><span class="line">                $msg = &quot;该文件不是gif格式的图片！&quot;;</span><br><span class="line">                @unlink($target_path);</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                //给新图片指定文件名</span><br><span class="line">                srand(time());</span><br><span class="line">                $newfilename = strval(rand()).&quot;.gif&quot;;</span><br><span class="line">                //显示二次渲染后的图片（使用用户上传图片生成的新图片）</span><br><span class="line">                $img_path = UPLOAD_PATH.&#x27;/&#x27;.$newfilename;</span><br><span class="line">                imagegif($im,$img_path);</span><br><span class="line"></span><br><span class="line">                @unlink($target_path);</span><br><span class="line">                $is_upload = true;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            $msg = &quot;上传出错！&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        $msg = &quot;只允许上传后缀为.jpg|.png|.gif的图片文件！&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>只允许上传 <strong>JPG</strong> <strong>PNG</strong> <strong>gif</strong> 在源码中使用 <code>imagecreatefromgif()</code> 函数对图片进行二次生成。生成的图片保存在，upload 目录下。</p>
<h4 id="7-4-2-绕过图片二次渲染攻击。"><a href="#7-4-2-绕过图片二次渲染攻击。" class="headerlink" title="7.4.2 绕过图片二次渲染攻击。"></a>7.4.2 绕过图片二次渲染攻击。</h4><p>首先判断图片是否允许上传 gif，gif 图片在二次渲染后，与原图片差别不会太大。所以二次渲染攻击最好用 git 图片马。</p>
<p><em><strong>制作图片马</strong></em><br>先将原图片上传，再下载渲染后的图片进行对比，找相同处，覆盖字符串，填写一句话后门，或者恶意指令。<br><img src="/image/%E5%AF%B9%E6%AF%94%E6%88%AA%E5%8F%96%E5%86%85%E5%AE%B9.png" alt="对比截取内容"><br>原图片与渲染后的图片这个位置的字符串没有改变所在原图片这里替换成 <code>&lt;?php phpinfo();?&gt;</code> 直接上传即可。<br><img src="/image/%E5%88%B6%E4%BD%9C%E5%9B%BE%E7%89%87%E9%A9%AC.png" alt="制作图片马"><br><img src="/image/%E6%88%AA%E5%8F%96%E5%9B%BE%E7%89%87%E7%BB%95%E8%BF%87.png" alt="截取图片绕过"></p>
<h3 id="7-5-数组绕过上传"><a href="#7-5-数组绕过上传" class="headerlink" title="7.5 数组绕过上传"></a>7.5 数组绕过上传</h3><p>有的文件上传，如果支持数组上传或者数组命名。如果逻辑写的有问题会造成安全隐患，导致不可预期的上传。这种上传攻击，它是属于攻击者白盒审计后发现的漏洞居多。</p>
<h4 id="7-5-1-数组绕过代码分析"><a href="#7-5-1-数组绕过代码分析" class="headerlink" title="7.5.1 数组绕过代码分析"></a>7.5.1 数组绕过代码分析</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = false;</span><br><span class="line">$msg = null;</span><br><span class="line">if(!empty($_FILES[&#x27;upload_file&#x27;]))&#123;</span><br><span class="line">    //检查MIME</span><br><span class="line">    $allow_type = array(&#x27;image/jpeg&#x27;,&#x27;image/png&#x27;,&#x27;image/gif&#x27;);      //允许上传类型</span><br><span class="line">    if(!in_array($_FILES[&#x27;upload_file&#x27;][&#x27;type&#x27;],$allow_type))&#123;      </span><br><span class="line">        $msg = &quot;禁止上传该类型文件!&quot;;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        //检查文件名</span><br><span class="line">        $file = empty($_POST[&#x27;save_name&#x27;]) ? $_FILES[&#x27;upload_file&#x27;][&#x27;name&#x27;] : $_POST[&#x27;save_name&#x27;];     //检查是否为空,储存文件名用于匹配白名单</span><br><span class="line">        if (!is_array($file)) &#123;</span><br><span class="line">            $file = explode(&#x27;.&#x27;, strtolower($file));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $ext = end($file);      //获取数组中的文件名</span><br><span class="line">        $allow_suffix = array(&#x27;jpg&#x27;,&#x27;png&#x27;,&#x27;gif&#x27;);</span><br><span class="line">        if (!in_array($ext, $allow_suffix)) &#123;</span><br><span class="line">            $msg = &quot;禁止上传该后缀文件!&quot;;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            $file_name = reset($file) . &#x27;.&#x27; . $file[count($file) - 1];      //将数组中的文件名名以 . 隔开再进行重组。因最后提取数组末尾代码有逻辑错误可绕过</span><br><span class="line">            $temp_file = $_FILES[&#x27;upload_file&#x27;][&#x27;tmp_name&#x27;];</span><br><span class="line">            $img_path = UPLOAD_PATH . &#x27;/&#x27; .$file_name;</span><br><span class="line">            if (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $msg = &quot;文件上传成功！&quot;;</span><br><span class="line">                $is_upload = true;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                $msg = &quot;文件上传失败！&quot;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    $msg = &quot;请选择要上传的文件！&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先检测文件类型，看到可控参数 save_name 如果不是数组，后缀名不是图片禁止上传。<br>如果是数组绕过图片类型检测 接着处理数组。<br>首先 一个例子的处理。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$file= $_GET[&#x27;save_name&#x27;];</span><br><span class="line">echo $file_name = reset($file) . &#x27;.&#x27; . $file[count($file) - 1];</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>如果是两个参数 拼接字符串是 <code>aaaaaaa.php/.png</code><br><img src="/image/test1.png" alt="test1"><br>如果下表是 1 为正常图片上传，如果下表大于 1 因为<code>count()-1</code>，则png就不显示。拼接字符串 <code>aaaaaaa.php/.</code> 在<code>move_uploaded_file()</code>函数中 &#x2F;.在window会自动忽略 所以可以移动到指定目录。<br><img src="/image/test1.png" alt="test2"></p>
<h4 id="7-5-2-数组绕过攻击方法"><a href="#7-5-2-数组绕过攻击方法" class="headerlink" title="7.5.2 数组绕过攻击方法"></a>7.5.2 数组绕过攻击方法</h4><p>构造上传表单，设置数组上传。从代码中，可以知道第二个数组必须大于 1 即可第二个数组的值就获取不了，字符串拼接起来就是 1.php&#x2F;. 就能上传1.php。要把<code>Content-Type:</code>换成<code>imag ![设置参数1](/image/设置参数1.png) ![设置参数2](/image/设置参数2.png) 也可用</code>`绕过<br><img src="/image/%E7%BB%95%E8%BF%87.png" alt="\绕过"></p>
<h3 id="7-6-文件上传其他漏洞"><a href="#7-6-文件上传其他漏洞" class="headerlink" title="7.6 文件上传其他漏洞"></a>7.6 文件上传其他漏洞</h3><p>nginx 0.83 &#x2F;1.jpg%00php<br>apahce 1x 或者 2x<br>当 apache 遇见不认识的后缀名，会从后向前解析例如 1.php.rar 不认识 rar 就向前解析，直到知道它认识的后缀名<br>phpcgi 漏洞(nginx iis7 或者以上) 上传图片后 1.jpg。访问 1.jpg&#x2F;1.php 也会解析成php。<br>Apache HTTPD 换行解析漏洞（CVE-2017-15715）<br>apache 通过 mod_php 来运行脚本，其 2.4.0-2.4.29 中存在 apache 换行解析漏洞，在解析 php 时 xxx.php\x0A 将被按照 PHP 后缀进行解析，导致绕过一些服务器的安全策略。</p>
<h4 id="7-6-1-文件上传漏洞懒人检测方法"><a href="#7-6-1-文件上传漏洞懒人检测方法" class="headerlink" title="7.6.1 文件上传漏洞懒人检测方法"></a>7.6.1 文件上传漏洞懒人检测方法</h4><p>判断是否为黑白名单，如果是白名单 寻找可控参数。如果是黑名单禁止上传，可以用有危害的后缀名批量提交测试，寻找遗留的执行脚本。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">.php</span><br><span class="line">.php5</span><br><span class="line">.php4</span><br><span class="line">.php3</span><br><span class="line">.php2</span><br><span class="line">.html</span><br><span class="line">.htm</span><br><span class="line">.phtml</span><br><span class="line">.pht</span><br><span class="line">.pHp</span><br><span class="line">.phP</span><br><span class="line">.pHp5</span><br><span class="line">.pHp4</span><br><span class="line">.pHp3</span><br><span class="line">.pHp2</span><br><span class="line">.Html</span><br><span class="line">.Htm</span><br><span class="line">.pHtml</span><br><span class="line">.jsp</span><br><span class="line">.jspa</span><br><span class="line">.jspx</span><br><span class="line">.jsw</span><br><span class="line">.jsv</span><br><span class="line">.jspf</span><br><span class="line">.jtml</span><br><span class="line">.jSp</span><br><span class="line">.jSpx</span><br><span class="line">.jSpa</span><br><span class="line">.jSw</span><br><span class="line">.jSv</span><br><span class="line">.jSpf</span><br><span class="line">.jHtml</span><br><span class="line">.asp</span><br><span class="line">.aspx</span><br><span class="line">.asa</span><br><span class="line">.asax</span><br><span class="line">.ascx</span><br><span class="line">.ashx</span><br><span class="line">.asmx</span><br><span class="line">.cer</span><br><span class="line">.aSp</span><br><span class="line">.aSpx</span><br><span class="line">.aSa</span><br><span class="line">.aSax</span><br><span class="line">.aScx</span><br><span class="line">.aShx</span><br><span class="line">.aSmx</span><br><span class="line">.cEr</span><br><span class="line">.sWf</span><br><span class="line">.swf</span><br><span class="line">.htaccess</span><br></pre></td></tr></table></figure>
<p>使用 burpsuite 抓包上传将后缀名设置成变量，把这些文件设置成一个字典批量提交。</p>
<p>查看数据包大小 查看确定时候可上传即可。</p>
<h2 id="8-文件上传的防御方法简述"><a href="#8-文件上传的防御方法简述" class="headerlink" title="8. 文件上传的防御方法简述"></a>8. 文件上传的防御方法简述</h2><p>服务器端使用白名单防御，修复 web 中间件的漏洞，禁止客户端存在可控参数，存放文件目录禁止脚本执行，限制后缀名 一定要设置图片格式 jpg、gif 、png 文件名随机的，不可预测。</p>
<h2 id="9-文件上传的攻击方法"><a href="#9-文件上传的攻击方法" class="headerlink" title="9. 文件上传的攻击方法"></a>9. 文件上传的攻击方法</h2><p><img src="/image/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E.png" alt="文件上传漏洞"></p>

    </div>

    
</div>
    <div class="footer" id="footer">
    <p><h4>版权所有 © 2020 | 作者: Mortal | 主题 By <a class="theme-author" target="_blank" rel="noopener" href="https://github.com/Xunzhuo/hexo-theme-coder" style="font-size:14px; color: #969696">Coder</a></h4>
    
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        <span id="busuanzi_container_site_pv">本站浏览总访问量: <span id="busuanzi_value_site_pv"></span></span>
        <span class="post-meta-divider">|</span>
        <span id="busuanzi_container_site_uv">本站访问人数: <span id="busuanzi_value_site_uv"></span></span>
    
    <label class="el-switch el-switch-blue el-switch-sm" style="vertical-align: sub;">
        <input type="checkbox" name="switch" id="update_style">
        <span class="el-switch-style"></span>
    </label>

    <!--         <script type="text/javascript">
    var cnzz_protocol = (("https:" == document.location.protocol) ? "https://" : "http://");
    document.write(unescape("%3Cspan id='cnzz_stat_icon_1278548644'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "v1.cnzz.com/stat.php%3Fid%3D1278548644%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
    </script> -->
</p>
</div>

<input type="hidden" id="web_style" value="black">
<input type="hidden" id="valine_appid" value="NOsswOncKgc8HOxqo9oxIWlX-gzGzoHsz">
<input type="hidden" id="valine_appKey" value="z1FihjWEbS8uIfUQdmCtK7zz">

<script src="/libs/jquery.min.js"></script>


<script src="/libs/highlight/highlight.pack.js"></script>

<script src='//cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js'></script>

<script src="/js/js.js"></script>

<style type="text/css">
.v * {
color: #698fca;
}
.v .vlist .vcard .vhead .vsys {
color: #3a3e4a;
}
.v .vlist .vcard .vh .vmeta .vat {
color: #638fd5;
}
.v .vlist .vcard .vhead .vnick {
color: #6ba1ff;
}
.v a {
color: #8696b1;
}
.v .vlist .vcard .vhead .vnick:hover {
color: #669bfc;
}
</style>
    <script type="text/javascript" color="173,174,173" opacity='1' zIndex="-2" count="99" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
</body>
</html>
